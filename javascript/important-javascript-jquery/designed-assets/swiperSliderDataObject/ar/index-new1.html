<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../style.css" type="text/css">
    <style type="text/css">
        .dates {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
        }
        .dates>* {
            width: 120px;
        }
        .popup {
            background: #ccc;
            padding-block: 16px;
        }
    </style>
</head>
<body>
    <main class="upcomingWebinars">
        <div class="dates"></div>
        <div class="details"></div>
    </main>
    <div class="popup">
        <div class="upcomingWebinars"></div>
    </div>
    <script>
        const imgLink = "../../../../images/2.jpg";
		// Always more than 2 hours difference in next webinar because webinar show after the 2 hours of starting.
        const datesWithDetails = [
            {
                date: "Thursday, Aug 27 2025",
                details: [
                    {
                        img: `${imgLink}`,
                        language: "French",
                        time: "03:07:10 PM DUBAI TIME",
                        hd: "Portfolio lorem",
                        shd: "Portfolio lorem1",
                        hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
                        text: [
                            { type: 'p', value: ["Laura Solorzano market Analysis lorem"] },
                        ],
                        analyst: [
                            { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
                            { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
                        ],
                        link: "#1"
                    },
                    // {
                    //     img: `${imgLink}`,
                    //     language: "French",
                    //     time: "22:00:00 | AEDTs",
                    //     hd: "Portfolio lorem",
                    //     shd: "Portfolio lorem1",
                    //     hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
                    //     text: [
                    //         { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] },
                    //         { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] }
                    //     ],
                    //     analyst: [
                    //         { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
                    //         { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
                    //     ],
                    //     link: "#2"
                    // }
                ]
            },
            // {
            //     date: "Friday, Aug 28 2025",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "20:20:30 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem1",
            //             hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
            //             text: [
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             // analyst: [
            //             //     { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //             //     { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             // ],
            //             link: "#3"
            //         },
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "20:20:45 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem1",
            //             hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
            //             text: [
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ],
            //             link: "#3"
            //         }
            //     ]
            // },
            // {
            //     date: "Friday, Sep 1 2025",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem2",
            //             hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
            //             text: [
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ],
            //             link: "#4"
            //         }
            //     ]
            // },
            // {
            //     date: "Thursday, Jun 12 2026",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "English",
            //             time: "19:30 | AEDTaa",
            //             hd: "Portfolio de Inversion en Trading",
            //             shd: "Portfolio lorem3",
            //             hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
            //             text: [
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             analyst: [{ type: 'text', value: "Laura Solorzano, Market Analysis dolor" }],
            //             link: "#5"
            //         },
            //         {
            //             img: `${imgLink}`,
            //             language: "SPANISH",
            //             time: "21:40 | AEDTdd",
            //             hd: "Portfolio ipsum",
            //             shd: "Portfolio lorem4",
            //             analyst: [
            //                 { type: 'p', items: ["<b>Laura Solorzano</b>", "Market Analysis lorem"] },
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             link: "#6"
            //         },
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem5",
            //             analyst: [
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis opsum", "Lorem ipsum dolor", "Lorem dolor"] }
            //             ],
            //             link: "#6"
            //         }
            //     ]
            // },
            // {
            //     date: "Friday, July 13 2026",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "English",
            //             time: "19:30 | AEDTaa",
            //             hd: "Portfolio de Inversion en Trading",
            //             shd: "Portfolio lorem6",
            //             analyst: [{ type: 'text', value: "Laura Solorzano, Market Analysis dolor" }],
            //         },
            //         {
            //             img: `${imgLink}`,
            //             language: "SPANISH",
            //             time: "21:40 | AEDTdd",
            //             hd: "Portfolio ipsums",
            //             shd: "Portfolio lorem7",
            //             analyst: [
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis loremssss" },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis loremccc" },
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             link: "#7"
            //         }
            //     ]
            // },
            // {
            //     date: "Saturday, Aug 14 2026",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem8",
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ],
            //             link: "#8"
            //         }
            //     ]
            // },
            // {
            //     date: "Saturday, Aug 16 2075",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem9",
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ]
            //         }
            //     ]
            // },
            // {
            //     date: "Saturday, Aug 24 2084",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem10",
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ]
            //         }
            //     ]
            // },
            // {
            //     date: "Saturday, Aug 30 2026",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem10",
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ]
            //         }
            //     ]
            // },
            // {
            //     date: "Saturday, Aug 24 2026",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "18:50 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem10",
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ]
            //         }
            //     ]
            // },
            // {
            //     date: "Friday, Aug 27 2026",
            //     details: [
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "15:18:20 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem1",
            //             hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
            //             text: [
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ]
            //         },
            //         {
            //             img: `${imgLink}`,
            //             language: "French",
            //             time: "15:18:29 | AEDTs",
            //             hd: "Portfolio lorem",
            //             shd: "Portfolio lorem1",
            //             hd1: "<b>Laura Solorzano1</b><span>Market Analysis lorem</span>",
            //             text: [
            //                 { type: 'p', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'ol', items: ["Laura Solorzano", "Market Analysis lorem"] }
            //             ],
            //             analyst: [
            //                 { type: 'ul', items: ["Laura Solorzano", "Market Analysis lorem"] },
            //                 { type: 'p', value: "Laura Solorzano, Market Analysis lorem" }
            //             ]
            //         }
            //     ]
            // },
        ];
    </script>
    <script>
        const arabic = window.location.href.includes('/ar/');
        const now = new Date();

        // 🔹 Helper: extract parts of a date
        function getDateParts(date, arabic) {
            return {
                dayName: date.toLocaleDateString(arabic ? 'ar' : 'en-US', { weekday: 'short' }).toUpperCase(),
                dayNum: date.getDate(),
                monthName: date.toLocaleDateString(arabic ? 'ar' : 'en-US', { month: 'short' }).toUpperCase(),
                yearNum: date.getFullYear(),
                enMonthName: date.toLocaleDateString('en-US', { month: 'short' })
            };
        }

        // Filter and sort upcoming dates & details
        function normalizeTimeStr(time) {
            const match = time.match(/(\d{1,2}:\d{2}(?::\d{2})?\s*(AM|PM)?)/i);
            return match ? match[1] : null;
        }

        function buildDate(dateStr, timeStr) {
            const normalized = normalizeTimeStr(timeStr);
            if (!normalized) return null;
            return new Date(`${dateStr} ${normalized}`);
        }

        const filteredAndSorted = datesWithDetails
            .map(entry => {
                const filteredDetails = entry.details.filter(detail => {
                    const dt = buildDate(entry.date, detail.time);
                    return dt && dt >= now;
                });
                return { ...entry, details: filteredDetails };
            })
            .filter(entry => entry.details.length > 0)
            .sort((a, b) => {
                const da = buildDate(a.date, a.details[0].time);
                const db = buildDate(b.date, b.details[0].time);
                return da - db;
            });

        filteredAndSorted.forEach(e => {
            e.details.sort((a, b) => buildDate(e.date, a.time) - buildDate(e.date, b.time));
        });

        function createtextHtml(text) {
            return text.map(a => {
                if (a.type === 'ul')
                    return `<ul>${(a.items || []).map(item => `<li>${item}</li>`).join('')}</ul>`;
                if (a.type === 'ol')
                    return `<ol>${(a.items || []).map(item => `<li>${item}</li>`).join('')}</ol>`;
                if (a.type === 'p')
                    return a.items ? a.items.map(item => `<p>${item}</p>`).join('') : `<p>${a.value}</p>`;
                if (a.type === 'text')
                    return `<p>${a.value || ""}</p>`;
                return '';
            }).join('');
        }

        function createAnalystHtml(analyst) {
            return analyst.map(a => {
                if (a.type === 'ul')
                    return `<ul>${(a.items || []).map(item => `<li>${item}</li>`).join('')}</ul>`;
                if (a.type === 'ol')
                    return `<ol>${(a.items || []).map(item => `<li>${item}</li>`).join('')}</ol>`;
                if (a.type === 'p')
                    return a.items ? a.items.map(item => `<p>${item}</p>`).join('') : `<p>${a.value}</p>`;
                if (a.type === 'text')
                    return `<p>${a.value || ""}</p>`;
                return '';
            }).join('');
        }

        function createDetailsHtml(e, dayName, dayNum, monthName, yearNum, enMonthName) {
            return e.details.map(d => {
                const [hours = "00", minutes = "00", seconds = "00"] = d.time?.match(/\d+/g) || [];
                const fullDate = `${dayNum} ${enMonthName} ${yearNum}, ${hours} Hours:${minutes} Minutes:${seconds} Seconds`;
                return `
                    <div class="uwDetails">
                        <div class="image">
                            ${d.img ? `<img src="${d.img}" width="155" height="194" alt="">` : ""}
                            ${d.hd1 ? `<p class="hd1">${d.hd1}</p>` : ""}
                            ${d.text ? `<div class="toggleText">${createtextHtml(d.text)}</div>` : ""}
                        </div>
                        <div class="text">
                            <p class="fullDate">${dayName}, ${dayNum} ${monthName} ${yearNum}</p>
                            <div class="tags">
                                ${d.language ? `<span class="clrd">${d.language}</span>` : ""}
                                ${d.time ? `<span>${d.time}</span>` : ""}
                            </div>
                            ${d.hd ? `<p class="hd">${d.hd} <img src="" width="27" height="28" alt=""></p>` : ""}
                            ${d.shd ? `<p class="shd">${d.shd}</p>` : ""}
                            ${d.analyst ? `<div class="toggleArea">${createAnalystHtml(d.analyst)}</div>` : ""}
                        </div>
                        <div class="timer">
                            <ul data-date="${fullDate}">
                                <li><b></b><span>${arabic ? `الأيام` : `DAYS`}</span></li>
                                <li><b></b><span>${arabic ? `الساعات` : `HRS`}</span></li>
                                <li><b></b><span>${arabic ? `الدقائق` : `MINS`}</span></li>
                                <li><b></b><span>${arabic ? `الثواني` : `SECS`}</span></li>
                            </ul>
                            <a href=${d.link ? d.link : "#"}>${arabic ? `شاهد من هنا` : `Watch Here`}</a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render filteredAndSorted
        filteredAndSorted.forEach(e => {
            const eventDate = new Date(e.date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (eventDate >= today) {
                const { dayName, dayNum, monthName, yearNum, enMonthName } = getDateParts(eventDate, arabic);

                document.querySelector(".dates").innerHTML += `
                    <div class="swiper-slide">
                        <div class="uwTab">
                            <span class="day">${dayName}</span>
                            <span class="date">${dayNum}</span>
                            <span class="month">${monthName}</span>
                            <span class="year">${yearNum}</span>
                        </div>
                    </div>
                `;
                document.querySelector(".details").innerHTML += `
                    <div class="swiper-slide">${createDetailsHtml(e, dayName, dayNum, monthName, yearNum, enMonthName)}</div>
                `;
            }
        });

        function startCountdown(ul) {
            const bTags = ul.querySelectorAll('li b');
            const dateStr = ul.getAttribute('data-date');
            const dateMatch = dateStr.match(/(\d{1,2}) (\w+) (\d{4}), (\d{1,2}) Hours:(\d{1,2}) Minutes:(\d{1,2}) Seconds/);
            if (!dateMatch) return;

            const [, day, monthName, year, hours, minutes, seconds] = dateMatch;
            const rawTime = ul.closest(".uwDetails").querySelector(".tags span:nth-child(2)")?.textContent || "";
            const normalized = normalizeTimeStr(rawTime) || `${hours}:${minutes}:${seconds}`;

            // Original event start time
            const targetDate = new Date(`${day} ${monthName} ${year} ${normalized}`);

            // 🔹 Extended expiry time (2 hours after start)
            const expiryDate = new Date(targetDate.getTime() + 2 * 60 * 60 * 1000);

            function update() {
                const now = new Date();

                // Countdown still shows time to start (before targetDate)
                let diffSec = Math.floor((targetDate - now) / 1000);

                // Once started, show zeroes but keep visible until +2h
                if (diffSec < 0) diffSec = 0;

                let diff = diffSec;
                const days = Math.floor(diff / 86400); diff %= 86400;
                const hrs = Math.floor(diff / 3600); diff %= 3600;
                const mins = Math.floor(diff / 60); diff %= 60;
                const secs = diff;

                bTags[0].textContent = String(days).padStart(2, '0');
                bTags[1].textContent = String(hrs).padStart(2, '0');
                bTags[2].textContent = String(mins).padStart(2, '0');
                bTags[3].textContent = String(secs).padStart(2, '0');

                // if (now >= expiryDate) { // 🔹 Remove webinar only AFTER 2h from its start time
                if (diffSec <= 0) { // current time expiryDate
                    const parent = ul.closest('.uwDetails');
                    if (parent) parent.remove();
                    const gbd = document.querySelector('.gallery-big .details');
                    if (gbd) gbd.style.height = '';
                    checkEmptySwiperSlide();
                    updatePopupFirstUpcoming(); // keep popup updated
                }
            }

            update();
            setInterval(update, 1000);
        }

        function checkEmptySwiperSlide() {
            const gallerySwiper = document.querySelector('.gallery-big .details .swiper-slide');
            if (gallerySwiper && gallerySwiper.children.length === 0) {
                gallerySwiper.innerHTML = generateEmptyMessage();
                gallerySwiper.closest(".details").style.height = "";
            }
        }

        function generateEmptyMessage() {
            return arabic ?
                `<div class="uwDetails message">انتهت جميع ندوات اليوم التعليمية. يمكنك الاختيار من بين الندوات القادمة.</div>` :
                `<div class="uwDetails message">All of today's educational webinars are over. You can choose from the upcoming educational webinars.</div>`;
        }

        function checkEmptyThumbs() {
            const dates = document.querySelector(".upcomingWebinars .gallery-thumbs .dates");
            if (dates && dates.children.length === 0) {
                const oldDiv = document.querySelector('.upcomingWebinars .slider');
                if (oldDiv) oldDiv.outerHTML = generateEmptyThumbsMessage();
            }
        }

        function generateEmptyThumbsMessage() {
            return arabic ?
                `<div class="uwDetails message">سيتم إطلاق الندوات التعليمية عبر الإنترنت قريبًا جدًا.</div>`
                :
                `<div class="uwDetails message">Educational webinars will be launched very soon.</div>`;
        }

        checkEmptyThumbs();
        document.querySelectorAll('.upcomingWebinars ul[data-date]').forEach(startCountdown);

        // 🔹 Function to update popup with the first available webinar
        function updatePopupFirstUpcoming() {
            const first = document.querySelector(".details .uwDetails");
            const popup = document.querySelector(".popup .upcomingWebinars");

            if (!first) {
                popup.innerHTML = arabic ?
                    `<div class="uwDetails message">لا توجد ندوات تعليمية قادمة حاليا.</div>`
                    :
                    `<div class="uwDetails message">No upcoming webinars at the moment.</div>`;
                return;
            }

            const eventDateText = first.querySelector(".fullDate")?.textContent || "";
            const [dayName, dayNum, monthName, yearNum] = eventDateText.split(/[\s,]+/);

            let popupHtml = first.outerHTML.replace(/<div class="timer">[\s\S]*?<\/div>/, "");
            popup.innerHTML = popupHtml;
        }

        // 🔹 Initialize popup at load
        updatePopupFirstUpcoming();
    </script>
    <script>
        document.querySelectorAll(".upcomingWebinars .uwDetails .text .hd > img").forEach(img => {
            img.addEventListener("click", function () {
                this.closest(".uwDetails").classList.toggle("active");

                // const upcomingWebinars = this.closest(".upcomingWebinars");
                // const swiperWrapper = upcomingWebinars.querySelector(".gallery-big .swiper-wrapper");
                // if (swiperWrapper) {
                //     swiperWrapper.style.height = "";
                // }
            });
        });
    </script>

</body>
</html>